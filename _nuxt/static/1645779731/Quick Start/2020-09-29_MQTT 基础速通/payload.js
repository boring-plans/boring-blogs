__NUXT_JSONP__("/Quick%20Start/2020-09-29_MQTT%20%E5%9F%BA%E7%A1%80%E9%80%9F%E9%80%9A", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){return {data:[{article:{slug:"2020-09-29_MQTT 基础速通",title:"MQTT 基础速通",date:"2020-09-29T00:00:00.000Z",category:"Quick Start",toc:[{id:q,depth:m,text:q},{id:A,depth:m,text:B},{id:r,depth:m,text:r},{id:C,depth:3,text:D},{id:s,depth:m,text:s},{id:t,depth:m,text:t},{id:u,depth:m,text:u}],body:{type:"root",children:[{type:b,tag:n,props:{id:q},children:[{type:b,tag:g,props:{href:"#%E6%A6%82%E8%A7%88",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:q}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"所谓 MQTT 即 Message Queuing Telemetry Transport，译为 "},{type:b,tag:f,props:{},children:[{type:a,value:"消息队列遥测传输协议"}]},{type:a,value:"。"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"其特点如下："}]},{type:a,value:c},{type:b,tag:o,props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"是一种基于 "},{type:b,tag:f,props:{},children:[{type:a,value:"发布\u002F订阅（publish\u002Fsubscribe）"}]},{type:a,value:" 模式的\"轻量级\"通讯协议"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"基于 TCP\u002FIP 协议"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"支持 QoS（Quality of Service，指一个网络能够利用各种基础技术，为指定的网络通信提供更好的服务能力，是网络的一种安全机制， 是用来解决网络延迟和阻塞等问题的一种技术（百度百科））"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"报文小，开销低，带宽占用低"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:n,props:{id:A},children:[{type:b,tag:g,props:{href:"#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:B}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"MQTT 中，broker 负责依据 topic 中转 publisher 发布的信息给 subscriber。MQTT 中的 topic 不需要预先建立，发布者发送消息到某个主题、订阅者订阅某个主题的时候，broker 就会自动创建这个主题。另外，topic 是有层级的，层级支持通配符："},{type:b,tag:f,props:{},children:[{type:a,value:"+ "}]},{type:a,value:"与 "},{type:b,tag:f,props:{},children:[{type:a,value:E}]},{type:a,value:"："}]},{type:a,value:c},{type:b,tag:o,props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:"+"}]},{type:a,value:" 通配单层，比如 "},{type:b,tag:f,props:{},children:[{type:a,value:"news\u002F+"}]},{type:a,value:F},{type:b,tag:f,props:{},children:[{type:a,value:G}]},{type:a,value:"，"},{type:b,tag:f,props:{},children:[{type:a,value:"news\u002F+\u002Fbasketball"}]},{type:a,value:" 可匹配到 "},{type:b,tag:f,props:{},children:[{type:a,value:H}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:f,props:{},children:[{type:a,value:E}]},{type:a,value:" 通配多层，比如 "},{type:b,tag:f,props:{},children:[{type:a,value:"news\u002F#"}]},{type:a,value:F},{type:b,tag:f,props:{},children:[{type:a,value:"news"}]},{type:a,value:"、 "},{type:b,tag:f,props:{},children:[{type:a,value:G}]},{type:a,value:"、"},{type:b,tag:f,props:{},children:[{type:a,value:H}]},{type:a,value:" 以及 "},{type:b,tag:f,props:{},children:[{type:a,value:"news\u002Fsports\u002Fbasketball\u002Fx"}]},{type:a,value:" 等等"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:n,props:{id:r},children:[{type:b,tag:g,props:{href:"#%E6%8A%A5%E6%96%87",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:r}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"MQTT 的消息主要由三部分组成：固定长度头部、可变长度头部、payload。"}]},{type:a,value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:b,tag:"table",props:{},children:[{type:b,tag:"thead",props:{},children:[{type:b,tag:v,props:{},children:[{type:b,tag:I,props:{},children:[{type:a,value:"组成部分"}]},{type:b,tag:I,props:{},children:[{type:a,value:"说明"}]}]}]},{type:b,tag:"tbody",props:{},children:[{type:b,tag:v,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"固定长度头部"}]},{type:b,tag:p,props:{},children:[{type:a,value:"占 2 字节大小，所有消息中均存在"}]}]},{type:b,tag:v,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"可变长度头部"}]},{type:b,tag:p,props:{},children:[{type:a,value:J}]}]},{type:b,tag:v,props:{},children:[{type:b,tag:p,props:{},children:[{type:a,value:"payload"}]},{type:b,tag:p,props:{},children:[{type:a,value:J}]}]}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"MQTT 的主要消息类型有："}]},{type:a,value:c},{type:b,tag:o,props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"CONNECT \u002F CONNACK - connect"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"PUBLISH \u002F PUBACK - publish"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"SUBSCRIBE \u002F SUBACK - subscribe"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"UNSUBSCRIBE \u002F UNSUBACK - unsubscribe"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"PINGREQ \u002F PINGRESP - ping（心跳）"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"DISCONNECT - disconnect"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"特殊地，PINGREQ \u002F PINGRESP 和 DISCONNECT 两种消息没有可变头部、payload，其大小只有 2 字节。另外，在 CONNECT 报文的可变长度头部里，有个 Protocol Version 的字段。为了节省空间，只有一个字节。所以版本号不是按照字符串 \"3.1.1\" 存放的，而是使用数字 4 来表示 3.1.1 版本。"}]},{type:a,value:c},{type:b,tag:"h3",props:{id:C},children:[{type:b,tag:g,props:{href:"#qos",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:D}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"针对不同的场景，MQTT 设计了 3 个 QoS 等级："}]},{type:a,value:c},{type:b,tag:o,props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"QoS0 至多一次 - 是一种 \"fire and forget\" 的消息发送模式：Sender (可能是 Publisher 或者 Broker) 发送一条消息之后，就不再关心它有没有发送到对方，也不设置任何重发机制。适用于环境传感器数据传输等，丢失一次记录无所谓，因为很快会有新的数据上报。"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"QoS1 至少一次 - 包含了简单的重发机制，Sender 发送消息之后等待接收者的 ACK，如果没收到 ACK 则重新发送消息。这种模式能保证消息至少能到达一次，但可能会因此产生重复消息。"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"QoS2 只有一次 - 设计了 "},{type:b,tag:g,props:{href:"https:\u002F\u002Fdocs.emqx.io\u002Fbroker\u002Fv3\u002Fen\u002Fprotocol.html#qos2-message-publish-and-subscribe",rel:[w,x,y],target:z},children:[{type:a,value:"略微复杂"}]},{type:a,value:" 的重发和重复消息发现机制，保证消息到达对方并且严格值到达一次，适用于计费系统中。"}]},{type:a,value:c}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:n,props:{id:s},children:[{type:b,tag:g,props:{href:"#%E4%BC%9A%E8%AF%9D%E4%BF%9D%E6%8C%81",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:s}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"MQTT 协议通过在 connect 报文里，配置 "},{type:b,tag:f,props:{},children:[{type:a,value:"keepalive"}]},{type:a,value:" 字段，来设置心跳包（PINGREQ\u002FPINGRESP）的发送时间间隔。当长时间无法收到设备的 PINGREQ 的时候，broker 就会认为设备已经下线。因此，keepalive 可以察觉异常的同时，亦可以达到会话保持的作用。"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"此外，在 CONNECT 报文里设置 "},{type:b,tag:f,props:{},children:[{type:a,value:"CleanSession"}]},{type:a,value:" 字段为 False 的设备，断线后重新上线后，则 broker 会将存储的："}]},{type:a,value:c},{type:b,tag:o,props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"设备所有的订阅"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"还未被设备确认的 QoS1 和 QoS 消息"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"设备离线时错过的消息"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"发送给其。"}]},{type:a,value:c},{type:b,tag:n,props:{id:t},children:[{type:b,tag:g,props:{href:"#%E9%81%97%E5%98%B1%E6%9C%BA%E5%88%B6",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:t}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"MQTT 设计了遗愿（Last Will、Testament） 消息，让 Broker 在发现设备异常下线的情况下，帮助设备发布一条遗愿消息到指定的主题。"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"实际上在某些 "},{type:b,tag:g,props:{href:"https:\u002F\u002Fwww.emqx.io\u002Fcn\u002Fproducts\u002Fbroker",rel:[w,x,y],target:z},children:[{type:a,value:"MQTT 服务器"}]},{type:a,value:" 的实现里 (比如 EMQ X)，设备上线或下线的时候 broker 会通过某些系统主题发布设备状态更新，更符合实际应用场景。"}]},{type:a,value:c},{type:b,tag:n,props:{id:u},children:[{type:b,tag:g,props:{href:"#%E5%8F%82%E8%80%83",ariaHidden:h,tabIndex:i},children:[{type:b,tag:j,props:{className:[k,l]},children:[]}]},{type:a,value:u}]},{type:a,value:c},{type:b,tag:o,props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:c},{type:b,tag:e,props:{},children:[{type:b,tag:g,props:{href:"https:\u002F\u002Fjuejin.im\u002Fpost\u002F6844904205463879688",rel:[w,x,y],target:z},children:[{type:a,value:"MQTT 协议是什么"}]}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:c},{type:b,tag:e,props:{},children:[{type:b,tag:g,props:{href:"https:\u002F\u002Fwww.runoob.com\u002Fw3cnote\u002Fmqtt-intro.html",rel:[w,x,y],target:z},children:[{type:a,value:"MQTT 入门介绍"}]}]},{type:a,value:c}]},{type:a,value:c}]}]},dir:"\u002FQuick Start",path:"\u002FQuick Start\u002F2020-09-29_MQTT 基础速通",extension:".md",createdAt:K,updatedAt:K},articles:[]}],fetch:{},mutations:[]}}("text","element","\n","li","p","code","a","true",-1,"span","icon","icon-link",2,"h2","ul","td","概览","报文","会话保持","遗嘱机制","参考","tr","nofollow","noopener","noreferrer","_blank","发布订阅模式","发布\u002F订阅模式","qos","QoS","#"," 可以匹配 ","news\u002Fsports","news\u002Fsports\u002Fbasketball","th","某些类型的消息中存在","2022-02-25T09:00:35.395Z")));